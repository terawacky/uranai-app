import streamlit as st
from datetime import datetime, time, date
import pandas as pd

# ãƒšãƒ¼ã‚¸è¨­å®š
st.set_page_config(page_title="æœ¬æ ¼å››æŸ±æ¨å‘½ãƒ»ç²¾å¯†é‘‘å®š", layout="wide")

# --- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ ---
jukkan = ["ç”²", "ä¹™", "ä¸™", "ä¸", "æˆŠ", "å·±", "åºš", "è¾›", "å£¬", "ç™¸"]
junishi = ["å­", "ä¸‘", "å¯…", "å¯", "è¾°", "å·³", "åˆ", "æœª", "ç”³", "é…‰", "æˆŒ", "äº¥"]
gogyo_desc = {
    "ç”²": "å¤§æ¨¹ã®äººã€‚çœŸã£ç›´ãã§æ­£ç¾©æ„ŸãŒå¼·ãã€å‘ä¸Šå¿ƒã«æº¢ã‚Œã¦ã„ã¾ã™ã€‚",
    "ä¹™": "è‰èŠ±ã®äººã€‚æŸ”è»Ÿæ€§ãŒã‚ã‚Šã€å‘¨å›²ã¨å”èª¿ã—ãªãŒã‚‰ç²˜ã‚Šå¼·ãé€²ã¿ã¾ã™ã€‚",
    "ä¸™": "å¤ªé™½ã®äººã€‚æ˜ã‚‹ãæ´»å‹•çš„ã§ã€å‘¨å›²ã‚’ç…§ã‚‰ã™ã‚«ãƒªã‚¹ãƒæ€§ãŒã‚ã‚Šã¾ã™ã€‚",
    "ä¸": "ç¯ç«ã®äººã€‚å†…é¢ã«æƒ…ç†±ã‚’ç§˜ã‚ã€æ´å¯ŸåŠ›ã«å„ªã‚ŒãŸç¤¼å„€æ­£ã—ã„äººã§ã™ã€‚",
    "æˆŠ": "å±±å²³ã®äººã€‚ã©ã£ã—ã‚Šã¨ã—ãŸå®‰å®šæ„ŸãŒã‚ã‚Šã€ä¿¡é ¼ã‚’é›†ã‚ã‚‹åŒ…å®¹åŠ›ãŒã‚ã‚Šã¾ã™ã€‚",
    "å·±": "ç”°åœ’ã®äººã€‚æ„›æƒ…æ·±ãã€å¤šæ‰ã§äººã‚’è‚²ã¦ã‚‹èƒ½åŠ›ã«é•·ã‘ã¦ã„ã¾ã™ã€‚",
    "åºš": "é‹¼é‰„ã®äººã€‚å¼·ã„æ„å¿—ã¨æ±ºæ–­åŠ›ã€è¡Œå‹•åŠ›ã‚’æŒã¡ã€å·±ã‚’é›ãˆä¸Šã’ã¾ã™ã€‚",
    "è¾›": "å®çŸ³ã®äººã€‚ç¹Šç´°ãªæ„Ÿæ€§ã¨ç¾æ„è­˜ã‚’æŒã¡ã€è‹¦åŠ´ã‚’çµŒã¦è¼ãã‚’å¢—ã—ã¾ã™ã€‚",
    "å£¬": "å¤§æµ·ã®äººã€‚è‡ªç”±å¥”æ”¾ã§çŸ¥æ€§çš„ã€å¤§ããªæµã‚Œã«èº«ã‚’ä»»ã›ã‚‹åº¦é‡ãŒã‚ã‚Šã¾ã™ã€‚",
    "ç™¸": "é›¨éœ²ã®äººã€‚æ§ãˆã‚ã§ã™ãŒå‹¤å‹‰ã§ã€å‘¨å›²ã‚’æ½¤ã™çŸ¥æµã‚’æŒã£ã¦ã„ã¾ã™ã€‚"
}

st.title("ğŸ”® æœ¬æ ¼å››æŸ±æ¨å‘½ï¼šç²¾å¯†é‘‘å®šã‚·ã‚¹ãƒ†ãƒ ")

# --- ã‚µã‚¤ãƒ‰ãƒãƒ¼è¨­å®š ---
st.sidebar.header("ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å…¥åŠ›")

# æœ¬æ—¥ã®æ—¥ä»˜ã‚’å–å¾—
today_val = date.today()

# æ”¹å–„ï¼šåˆæœŸå€¤ã‚’ã€Œæœ¬æ—¥ã€ã«ã—ã¤ã¤ã€æ•°å­—ã§ã‚‚å¤‰æ›´å¯èƒ½ã«ã™ã‚‹
st.sidebar.write("â‘  ç”Ÿå¹´æœˆæ—¥ã‚’æ•°å­—ã§å…¥åŠ›")
y = st.sidebar.number_input("å¹´", min_value=1900, max_value=2100, value=today_val.year)
m = st.sidebar.number_input("æœˆ", min_value=1, max_value=12, value=today_val.month)
d = st.sidebar.number_input("æ—¥", min_value=1, max_value=31, value=today_val.day)

# ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®åˆæœŸå€¤ã‚‚ä¸Šè¨˜ã®æ•°å­—ã¨é€£å‹•
birth_date = st.sidebar.date_input(
    "â‘¡ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã§ç¢ºèªãƒ»å¾®èª¿æ•´", 
    value=date(y, m, d),
    min_value=date(1900, 1, 1), 
    format="YYYY/MM/DD"
)

birth_time = st.sidebar.time_input("èª•ç”Ÿæ™‚é–“ï¼ˆä»»æ„ï¼‰", value=time(12, 0))

# æ‰‹è¡“çµŒéï¼ˆä»»æ„å…¥åŠ›ï¼šãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ç©ºï¼‰
surgery_date = st.sidebar.date_input("æ‰‹è¡“çµŒéã‚’ç¢ºèªï¼ˆä»»æ„ï¼‰", value=None, format="YYYY/MM/DD")

if st.sidebar.button("é‘‘å®šã‚’å®Ÿè¡Œ"):
    # è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
    base_date = date(1900, 1, 1)
    diff_days = (birth_date - base_date).days
    n_idx = (diff_days + 10) % 60
    n_kan = jukkan[n_idx % 10]
    n_shi = junishi[n_idx % 12]

    # è¡¨ç¤º
    st.subheader(f"âœ¨ é‘‘å®šçµæœï¼šã‚ãªãŸã¯ã€Œ{n_kan}{n_shi}ã€ã®äººã§ã™")
    
    if surgery_date:
        # 2026å¹´1æœˆ11æ—¥æ™‚ç‚¹ã§ã®è¨ˆç®—
        days_passed = (date.today() - surgery_date).days
        st.success(f"ğŸ¥ æ‰‹è¡“ã‹ã‚‰ **{days_passed}æ—¥ç›®** ã§ã™ã€‚ç¾åœ¨ã®é‹å‹¢ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚")

    t1, t2 = st.tabs(["ğŸ“Š å®¿å‘½é‘‘å®šæ›¸", "ğŸ“ˆ 10å¹´ãƒã‚¤ã‚ªãƒªã‚ºãƒ "])

    with t1:
        st.markdown(f"### ã€ã‚ãªãŸã®æœ¬è³ªï¼š{n_kan}ã€‘")
        st.write(gogyo_desc.get(n_kan))
        st.table(pd.DataFrame({"é …ç›®": ["æ—¥æŸ±", "ä¸­å¿ƒäº”è¡Œ"], "è©³ç´°": [f"{n_kan}{n_shi}", f"{n_kan}ã®æ°—"]}))

    with t2:
        st.subheader("2026å¹´ã‹ã‚‰ã®é‹å‹¢ãƒã‚¤ã‚ªãƒªã‚ºãƒ ")
        years = [str(2026 + i) for i in range(11)]
        powers = [((n_idx + i * 7) % 12) + 1 for i in range(11)]
        st.line_chart(pd.DataFrame({"å¹´": years, "ãƒ‘ãƒ¯ãƒ¼": powers}).set_index("å¹´"))